<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<body>
  <script>
    // 观察者模式: 被观察者状态发生改变，观察者会做出不同的反应

    // 1. 创建一个被观察类
    class Subject {
      constructor(name) {
        this.name = name;
        this.state = 0; // 初始化状态   0默认状态，1有空闲，2没空
        // 7. 两个类产生关系
        this.obs = [];
      }

      // 3. 设置状态
      setState(val) {
        this.val = val;

        // 10. 收到反馈返回通知
        this.obs.forEach(item => {
          item.updateState();
        })
      }

      // 4. 获取状态
      getState() {
        return this.name = name;
      }

      // 7. 两个类的实例产生关系
      appendObs(obsInstance) {
        this.obs.push(obsInstance);
      }
    }

    // 2. 创建一个观察者类
    class Observer {
      constructor(name, sub) {
        this.name = name;
        // 10. 状态值更改
        this.stateVal = ["默认", "有空", "没空"];

        // 7. 两个类的实例产生关系
        this.sub = sub;
        this.sub.appendObs(this);
      }

      // 状态更新
      updateState() {
        console.log(this.sub.name + ": " + this.sub.state + "改成了" + this.stateVal[this.sub.getState()]);
      }
    }

    // 5. 创建实例
    let s = new Subject("sb");
    s.setState(1);

    // 6. 创建多个用户实例
    let o1 = new Observer("san", s);
    let o2 = new Observer("si", s);
    let o3 = new Observer("wu", s);
    let o4 = new Observer("liu", s);

    console.log(o1, o2, o3, o4);
    o1.updateState();
</script>
</body>
</html>